version: 2

models:
  - name: stg_eis__contract_counterpartyAccountDetails
    description: "Стадия нормализации данных из fz44_contract_counterpartyAccountDetails"
    columns:
      - name: sid
        description: |
          Уникальный идентификатор в ЕИС.
          
          Игнорируется при приеме первой версии документа.
          
          Назначается в ЕИС и заполняется при передаче.
          Назначается один раз при сохранении версии документа, в которой добавлены платежные реквизиты, не меняется в следующих версиях.
          При приеме последующих версий используется для идентификации платежных реквизитов в разных версиях документа. При приеме изменений документа, если поле заполнено, то контролируется, что в предыдущей версии документа найдены платежные реквизиты с указанным значением sid
        data_type: text
      - name: externalSid
        description: |
          Внешний идентификатор платежных реквизитов.
          Если при приеме изменений размещенного документа задано поле \"Уникальный идентификатор в ЕИС\" (sid), то для платежных реквизитов, идентифицируемых в разных версиях по полю \"Уникальный идентификатор в ЕИС\" (sid), в данном поле должно быть задано то же значение, что и в предыдущей версии документа. При этом, если в предыдущей версии документа для платежных реквизитов не задано данное поле, то при приеме изменений допускается его указание
        data_type: text
      - name: guid
        description: |
          GUID платежных реквизитов.
          Игнорируется при приеме, используется для электронного актирования
        data_type: text
      - name: accountType
        description: |
          Тип лицевого счёта.
          
          При приеме документа \"Электронный контракт\" (cpElectronicContract):
          
          - допустимые значения для организации-заказчика:
          01 - Лицевой счет в ФК; 
          02 - Лицевой счет в ФО;
          03 - Расчетный счет в банке;
          04 - Счет эскроу;
          
          - допустимые значения для организации-поставщика:
          01 - Лицевой счет в ФК; 
          02 - Лицевой счет в ФО;
          03 - Расчетный счет в банке.
          
          При приеме документа \"Информация о заключенном контракте\" (contract):
          
          - допустимые значения для организации-заказчика:
          01 - Лицевой счет в ФК; 
          02 - Лицевой счет в ФО;
          03 - Расчетный счет в банке;
          04 - Счет эскроу;
          
          - допустимые значения для организации-поставщика:
          01 - Лицевой счет в ФК; 
          02 - Лицевой счет в ФО;
          03 - Расчетный счет в банке;
          
          - допустимые значения для организации с видом \"Уплата неустоек (штрафов пеней)\":
          05 - Счет для перечисления денежных средств;
          
          - допустимые значения для организации с видом \"Уплата налогов\":
          06 - Счет для уплаты налогов
        data_type: text
      - name: personalAccountNumber
        description: |
          Номер лицевого счёта.
          
          Если тип счета \"01 - Лицевой счет в ФК\" или \"02 - Лицевой счет в ФО\", то контролируется обязательность заполнения.
          
          Организация-заказчик:
          
          - Если в поле тип счета значение \"03 - Расчетный счет в банке\" или \"04 - Счет эскроу\", ТО проверяется, что поле не заполнено.
          
          - Если в поле тип счета значение \"01 - Лицевой счет в ФК\", ТО проверяется, что указано значение из справочника nsiOrganization (значение personalAccount c типом лицевого счета personalAccountType = \"FK\") для организации, идентифицируемой по полю \"Код по СПЗ\" (customerInfo/regNum) или \"Код по Сводному Реестру\" (customerInfo/consRegistryNum).
          
          - Если в поле тип счета значение \"02 - Лицевой счет в ФО\", ТО проверяется, что указано значение из справочника nsiOrganization (значение personalAccount c типом лицевого счета personalAccountType = \"FO\") для организации, идентифицируемой по полю \"Код по СПЗ\" (customerInfo/regNum) или \"Код по Сводному Реестру\" (customerInfo/consRegistryNum).
          
          - Если в поле тип счета значение \"05 - Счет для перечисления денежных средств\", ТО проверяется, что указано значение из справочника nsiOrganization (значение personalAccount c типом лицевого счета personalAccountType \"FK\" или \"FO\") для организации, идентифицируемой по полю \"Код по СПЗ\" (customerInfo/regNum) или \"Код по Сводному Реестру\" (customerInfo/consRegistryNum).
          
          Организация-поставщик:
          
          - Если в поле тип счета значение \"03 - Расчетный счет в банке\", ТО проверяется, что поле не заполнено.
          
          - Если в поле тип счета значение \"01 - Лицевой счет в ФК\",
          ТО при приеме проверяется, что в справочнике КРЛС (nsiKRLS) для поставщика, идентифицируемого по ИНН и КПП (если есть), существует указанный номер лицевого счета.
          
          - Если в поле тип счета значение \"02 - Лицевой счет в ФО\",
          ТО при приеме проверяется, что в справочнике СВР (nsiSVR) для поставщика, идентифицируемого по ИНН и КПП (если есть), существует указанный номер лицевого счета.
          
          Организация с видом  \"Уплата неустоек (штрафов пеней)\" проверяется, что указано значение из справочника nsiOrganization (значение personalAccount c типом лицевого счета personalAccountType \"FK\" или \"FO\") для организации, идентифицируемой по полю \"Код по СПЗ\" (regNum) или \"Код по Сводному Реестру\" (consRegistryNum).
          
          Для организации с видом \"Уплата налогов\" проверяется, что поле не заполнено.
          
          Алгоритмы и контроли при приеме значения поля выполняются при включенной в ЕИС \"Настройка вызова интеграционных контролей для приема структурированной заявки» (FCSNF-18825)
        data_type: text
      - name: code
        description: "Код поступлений"
        data_type: text
      - name: name
        description: "Наименование поступлений. Игнорируется при приеме. При передаче заполняется значением из справочника \"Коды поступлений для АУ/БУ\" (nsiReceiptCodes)"
        data_type: text
      - name: creditOrgName
        description: "Наименование банка, ТОФК. Игнорируется при приеме, заполняется автоматически при передаче в соответствие с указанным значением в поле \"БИК банка\" (bik)"
        data_type: text
      - name: detailsCreditOrgText
        description: |
          Реквизиты банка, ТОФК.
          
          Игнорируется при приеме, заполняется автоматически при передаче для документов:
          1) \"Электронный контракт\" (cpElectronicContract);
          2) \"Информация (проект информации) о заключенном контракте\" (contract)
          
          Используется при формировании печатной формы
        data_type: text
      - name: bankAccountNumber
        description: |
          Номер банковского (казначейского) счета.
          
          Если в поле «Тип лицевого счёта» (accountType) указано значение \"01 - Лицевой счет в ФК\", \"02 - Лицевой счет в ФО\", \"06 - Счет для уплаты налогов\" или (\"05 - Счет для перечисления денежных средств\" и заполнено поле \"Номер лицевого счёта\" (personalAccountNumber)),
          ТО при приеме проверяется, что значение поля присутствует в справочнике КРКС (nsiKRKS)
        data_type: text
      - name: bik
        description: |
          БИК банка, ТОФК.
          
          Если в поле «Тип лицевого счёта» (accountType) указано значение \"01 - Лицевой счет в ФК\", \"02 - Лицевой счет в ФО\", \"06 - Счет для уплаты налогов\" или (\"05 - Счет для перечисления денежных средств\" и заполнено поле \"Номер лицевого счёта\" (personalAccountNumber)),
          ТО при приеме проверяется, что значение соответствует БИК, указанному в справочнике КРКС (nsiKRKS) записи, которая найдена по значению поля \"Номер банковского (казначейского) счета\" (bankAccountNumber).
          
          Если в поле \"Тип лицевого счёта\" (accountType) указано значение \"03 - Расчетный счет в банке\", \"04 - Счет эскроу\" или (\"05 - Счет для перечисления денежных средств\" и не заполнено поле \"Номер лицевого счёта\" (personalAccountNumber)), то приеме проверяется, что значение поля присутсвует в справочнике БИК в актуальном состоянии.
          
          Алгоритмы и контроли при приеме значения поля выполняются при включенной в ЕИС \"Настройка вызова интеграционных контролей для приема структурированной заявки» (FCSNF-18825)
        data_type: text
      - name: corrAccountNumber
        description: |
          Корреспондентский счет банка, единый казначейский счет.
          
          При приеме проверяется, что указанное значение соответствует значению из справочника БИК. Поиск в справочнике производится по указанному в поле \"БИК банка\" (bik) значению.
          
          Алгоритмы и контроли при приеме значения поля выполняются при включенной в ЕИС \"Настройка вызова интеграционных контролей для приема структурированной заявки» (FCSNF-18825)
        data_type: text
      - name: counterpartyName
        description: |
          Наименование контрагента для платежного поручения.
          
          При приеме документа \"Электронный контракт\" (cpElectronicContract) и \"Информация о заключенном контракте\" (contract):
          
          игнорируется для организации-заказчика со следующими типами счетов:
          01 - Лицевой счет в ФК; 
          02 - Лицевой счет в ФО;
          03 - Расчетный счет в банке.
          
          В других случаях контролируется обязательность заполнения.
          
          Игнорируется при приеме-передаче, начиная с версии 14.0 при приеме документов: 
          1) Электронный контракт (cpElectronicContract);
          2) Информация (проект информации) о заключенном контракте (contract)
        data_type: text
      - name: counterparty160Name
        description: |
          Наименование контрагента для платежного поручения с размерностью 160 символов.
          
          При приеме документа \"Электронный контракт\" (cpElectronicContract) и \"Информация о заключенном контракте\" (contract2015):
          игнорируется для организации-заказчика со следующими типами счетов:
          01 - Лицевой счет в ФК; 
          02 - Лицевой счет в ФО;
          03 - Расчетный счет в банке.
          
          В других случаях контролируется обязательность заполнения.
          При этом, значание поля рассчитывается автоматически с помощью бизнесового алгоритма и, если полученное значение НЕ превышает 160 символов, то поле игнорируется при приеме. Иначе принимается и сохраняется, начиная с версии 14.0.
          
          Автоматический расчет НЕ выполняется (т.е. значение поля берется ТОЛЬКО из пакета) для поставщиков с типами:
          1) \"Физическое лицо РФ. Индивидуальный предприниматель. Поставщик культурных ценностей\" (individualPersonRFIndEntrisCulture);
          2) \"Физическое лицо РФ. Поставщик культурных ценностей\" (individualPersonRFisCulture);
          3) \"Физическое лицо иностранного государства. Поставщик культурных ценностей\" (individualPersonForeignStateisCulture).
          
          Поле не используется при приеме документов:
          1) \"Протокол подведения итогов определения поставщика (подрядчика, исполнителя) ЭА20 (аукцион в электронной форме с даты начала действия оптимизационного законопроекта 44-ФЗ) с информацией об участниках\" (epProtocolEF2020FinalPart);
          2) \"Протокол подведения итогов ЭOK20 (открытый конкурс в электронной форме с даты начала действия оптимизационного законопроекта 44-ФЗ) с информацией об участниках\" (epProtocolEOK2020FinalPart); 
          3) \"Протокол подведения итогов определения поставщика (подрядчика, исполнителя) ЭЗК20 (запрос котировок в электронной форме c 01.04.2021 года) с информацией об участниках\" (epProtocolEZK2020FinalPart);
          4) \"Протокол подведения итогов определения поставщика ЭЗТ (закупка товаров согласно ч.12 ст. 93 № 44-ФЗ) с информацией об участниках\" (epProtocolEZT2020FinalPart);
          5) \"Протокол подведения итогов определения поставщика (подрядчика, исполнителя) в ЭЗакА20 (закрытый аукцион в электронной форме с даты начала действия оптимизационного законопроекта 44-ФЗ)\" (epClosedProtocolEZakA2020Final);
          6) \"Протокол подведения итогов определения поставщика (подрядчика, исполнителя) в ЭЗакК20 (закрытый конкурс в электронной форме с даты начала действия оптимизационного законопроекта 44-ФЗ)\" (epClosedProtocolEZakK2020Final)
        data_type: text
      - name: code
        description: "Код по ОКТМО"
        data_type: text
      - name: name
        description: |
          Полное наименование.
          Игнорируется при приеме. При передаче заполняется значением из справочника \"Общероссийский классификатор территорий муниципальных образований\" (nsiOKTMO)
        data_type: text
      - name: isNotExist
        description: "Значение отсутствует в справочнике ОКТМО"
        data_type: boolean
      - name: KBK
        description: |
          КБК.
          
          При приеме документа \"Электронный контракт\" (cpElectronicContract) и \"Информация о заключенном контракте\" (contract):
          игнорируется для организации-заказчика
          
          В других случаях блок принимается, если заполнен
        data_type: text
